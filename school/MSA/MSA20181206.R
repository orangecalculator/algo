library(magrittr)

S <- vector("list",length=3)
S[[1]]<-matrix(c(0.5,0.1,-0.1,-0.2,0.1,27.5,-0.6,-0.3,
                 -0.1,-0.6,0.3,0.1,-0.2,-0.3,0.1,6.9),ncol=4)
S[[2]]<-matrix(c(0.9,-0.1,0.1,-0.7,-0.1,16.4,-0.4,19.0,
                 0.1,-0.4,0.1,-0.1,-0.7,19.0,-0.1,61.9),ncol=4)
S[[3]]<-matrix(c(0.7,0.1,-0.1,-0.5,0.1,21.9,-0.5,9.4,
                 -0.1,-0.5,0.1,0.1,-0.5,9.4,0.1,35.4),ncol=4)
m <- matrix(c(
  c(2.3,12.6,0.4,14.8),
  c(2.4,7.2,0.5,12.8),
  c(2.3,10.0,0.4,13.5)), ncol=3)

W <- (S[[1]]+S[[2]]+S[[3]])*19

B <- (m-apply(m,1,mean))
B <- 20 * B %*% t(B)

(-(60-1-(4+3)/2) * log(det(W)/det(B+W))) %>%
  pchisq(4*2,lower.tail = F)

(-(60-1-(3+3)/2) * log(det(W[1:3,1:3])/det(B[1:3,1:3]+W[1:3,1:3]))) %>%
  pchisq(3*2,lower.tail = F)
